<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>ë¶€ì—¬ì¤‘ì•™ì‹œì¥ ë””ì§€í„¸ ë§µ</title>
<style>
  :root{
    --primary:#2563eb; --primary-dark:#1e40af; --success:#10b981; --danger:#ef4444;
    --gray-50:#f9fafb; --gray-100:#f3f4f6; --gray-200:#e5e7eb; --gray-300:#d1d5db;
    --gray-600:#4b5563; --gray-800:#1f2937; --shadow-sm:0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow-md:0 4px 6px -1px rgb(0 0 0 / 0.1); --shadow-lg:0 10px 15px -3px rgb(0 0 0 / 0.1);
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html, body { height: 100%; overflow: hidden; }
  body{
    font-family:-apple-system,BlinkMacSystemFont,'Apple SD Gothic Neo','Pretendard',system-ui,sans-serif;
    background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); padding:20px; color:var(--gray-800);
  }
  .container{
    max-width:1600px; height: calc(100vh - 40px); margin:0 auto; background:white;
    border-radius:24px; box-shadow:var(--shadow-lg); overflow:hidden; display:flex; flex-direction:column;
  }
  header{ background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; padding: 24px 32px; }
  header h1{ font-size:1.8rem; font-weight:700; margin-bottom:8px; }
  .controls{ padding:16px 32px; background:var(--gray-50); border-bottom:1px solid var(--gray-200); }
  .controls-row{ display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
  input[type="search"]{
    flex:1; min-width:200px; padding:10px 14px; border:2px solid var(--gray-300);
    border-radius:10px; font-size:1rem; transition:all 0.2s;
  }
  .main{ display:flex; flex-direction:row; flex:1; min-height:0; position:relative; }
  .map-container{
    flex:1; padding:24px; background:var(--gray-50); position:relative;
    overflow:hidden; display:flex; flex-direction:column;
  }
  
  .time-control{
    display:flex; align-items:center; gap:16px; margin-bottom:16px; padding:16px;
    background:white; border-radius:12px; box-shadow:var(--shadow-sm); z-index: 10;
    flex-wrap: wrap;
  }
  .time-control label { font-weight: 600; color: var(--gray-800); }
  .time-slider-wrapper {
    flex: 1; min-width: 200px;
    position: relative; height: 20px; display: flex; align-items: center;
  }
  .time-marks {
    position: absolute; width: 100%; top: -12px; left: 0;
    display: flex; justify-content: space-between;
    font-size: 0.75rem; color: var(--gray-600);
  }
  .time-slider{
    -webkit-appearance:none; appearance:none; width:100%; height:10px;
    background:var(--gray-200); outline:none; border-radius:5px;
  }
  .time-slider::-webkit-slider-thumb{
    -webkit-appearance:none; appearance:none; width:20px; height:20px;
    background:var(--primary); cursor:pointer; border-radius:50%;
    border:none;
  }
  .time-slider::-moz-range-thumb{
    width:20px; height:20px; background:var(--primary); cursor:pointer;
    border-radius:50%; border:none;
  }
  .time-display{
    font-size:1.2rem; font-weight:700; color:var(--primary-dark);
    min-width: 60px; text-align: right;
  }
  
  .congestion-legend{ display:flex; gap:16px; padding:12px 16px; background:white; border-radius:12px; box-shadow:var(--shadow-sm); font-size:0.85rem; flex-wrap:wrap; margin-bottom:16px; z-index: 10; }
  .legend-item{ display:flex; align-items:center; gap:6px; }
  .legend-color{ width:24px; height:16px; border-radius:4px; }
  .map-wrapper{
    flex:1; position:relative; overflow:hidden; border-radius:16px;
    border:2px solid var(--gray-300); background: #C8BCA8;
    box-shadow:var(--shadow-md); touch-action:none; cursor:grab;
  }
  .market-map{ position:relative; width:2400px; height:600px; transform-origin:0 0; background-color: #E9E0D2; }
  .shop-area { position: absolute; left: 0; right: 0; background-color: #DCD7CD; }
  .area-top { top: 0; height: 250px; }
  .area-bottom { bottom: 0; height: 250px; }
  .main-road { position: absolute; top: 250px; left: 0; right: 0; height: 100px; background-color: #A09A8E; box-shadow: inset 0 0 10px rgba(0,0,0,0.1); }
  .main-road::after { content: ''; position: absolute; left: 0; right: 0; top: 50%; transform: translateY(-50%); height: 4px; background: repeating-linear-gradient(to right, #F7D716 0, #F7D716 20px, transparent 20px, transparent 40px); }
  .parking-lot { position: absolute; background: #C8BCA8; border: 2px solid #B3ADA2; display: flex; align-items: center; justify-content: center; color: #5A5245; font-weight: bold; font-size: 1.5rem; box-shadow: inset 0 0 5px rgba(0,0,0,0.1); }
  .alley { position: absolute; top: 0; bottom: 0; width: 25px; background: #E9E0D2; box-shadow: inset 0 0 8px rgba(0,0,0,0.1); }
  
  .congestion-overlay{ position:absolute; inset:0; pointer-events:none; transition:opacity 0.3s ease; }
  .congestion-zone{ position:absolute; border-radius:50%; filter:blur(60px); opacity:0.35; }
  
  .shop-pin{ position:absolute; transform:translate(-50%,-50%); z-index:10; transition:opacity 0.3s ease, filter 0.3s ease; }
  .shop-pin.dimmed, .shop-pin.closed{ opacity:0.3; filter:grayscale(80%); }
  .shop-pin button{ display:flex; flex-direction:column; align-items:center; gap:6px; padding:8px; background:white; border:2px solid var(--gray-300); border-radius:16px; cursor:pointer; transition:all 0.3s cubic-bezier(0.4,0,0.2,1); box-shadow:var(--shadow-sm); position:relative; }
  .shop-pin button:hover{ transform:translateY(-4px) scale(1.05); box-shadow:var(--shadow-lg); border-color:var(--primary); z-index:1000 !important; }
  .shop-pin.active button{ border-color:var(--primary); box-shadow:0 0 0 4px rgba(37,99,255,0.2); }
  .shop-pin .icon{ width:48px; height:48px; font-size:36px; display:flex; align-items:center; justify-content:center; }
  .shop-pin .name{ 
    font-size:0.8rem; font-weight:600; max-width:120px; text-align:center; line-height:1.3; color:var(--gray-800);
    height: 2.2em; display: flex; align-items: center; justify-content: center;
  }
  .shop-pin .tooltip { visibility: hidden; width: 160px; background-color: var(--gray-800); color: #fff; text-align: center; border-radius: 6px; padding: 8px; position: absolute; z-index: 1001; bottom: 110%; left: 50%; margin-left: -80px; opacity: 0; transition: opacity 0.3s; font-size: 0.85rem; pointer-events: none; }
  .shop-pin button:hover .tooltip { visibility: visible; opacity: 1; }
  
  .sidebar{ width:400px; background:white; border-left:1px solid var(--gray-200); display:flex; flex-direction:column; transition: width 0.3s ease, opacity 0.3s ease; max-height:100%; }
  .sidebar.hidden{ width:0; min-width:0; opacity:0; overflow:hidden; }
  .sidebar-content-wrapper { flex: 1; min-height: 0; display: flex; flex-direction: column; }
  .sidebar-tabs { display: flex; border-bottom: 1px solid var(--gray-200); }
  .tab-button { flex: 1; padding: 14px; text-align: center; background: none; border: none; cursor: pointer; font-size: 1rem; font-weight: 600; color: var(--gray-600); border-bottom: 3px solid transparent; transition: all 0.2s; }
  .tab-button.active { color: var(--primary); border-bottom-color: var(--primary); }
  .tab-panel { display: none; flex: 1; min-height: 0; overflow-y: auto; }
  .tab-panel.active { display: block; }
  .close-btn{ position:absolute; top:16px; right:16px; width:32px; height:32px; border:none; background:var(--gray-100); border-radius:8px; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:1.2rem; color:var(--gray-600); transition:all 0.2s; z-index:10; }
  
  .welcome-panel, .shop-detail { padding:24px; }
  .shop-detail { border-bottom: 1px solid var(--gray-200); }
  .welcome-panel h2{ font-size:1.8rem; font-weight:700; margin-bottom:16px; color:var(--primary); }
  .info-item{ display:flex; align-items:center; gap:8px; margin:8px 0; font-size:0.95rem; }
  .shop-detail h2{ font-size:1.5rem; font-weight:700; margin-bottom:12px; color:var(--gray-800); }
  .description{ color:var(--gray-600); line-height:1.6; margin-top:16px; font-size: 0.95rem; }
  .tags{ display:flex; gap:8px; flex-wrap:wrap; margin-bottom:16px; }
  .tag{ padding:6px 12px; background:var(--gray-100); border-radius:8px; font-size:0.85rem; font-weight:500; color:var(--gray-600); }
  .tag.goodtrae { background-color: #f0fdf4; color: #14532d; border: 1px solid var(--success); }
  .info-row{ display:flex; align-items:center; gap:8px; margin:12px 0; font-size:0.95rem; flex-wrap: wrap;}
  .status-indicator { font-weight: 600; margin-left: 8px; }
  .status-open { color: var(--success); }
  .status-closed { color: var(--danger); }
  .shop-list{ padding:20px; }
  .shop-list h3 { font-size: 1.1rem; font-weight: 600; margin-bottom: 12px; color: var(--gray-800); padding-bottom: 8px; border-bottom: 1px solid var(--gray-200);}
  .list-item{ width:100%; text-align:left; padding:14px 16px; margin-bottom:8px; background:var(--gray-50); border:2px solid transparent; border-radius:12px; cursor:pointer; transition:all 0.2s; }
  .list-item:hover{ background:var(--gray-100); border-color:var(--gray-300); }
  .list-item.active{ background:rgba(37,99,255,0.1); border-color:var(--primary); }
  .hide{display:none !important}
  
  #categoryFilters button { padding: 8px 14px; border: 2px solid var(--gray-300); border-radius: 10px; background-color: white; cursor: pointer; font-size: 0.9rem; transition: all 0.2s; }
  #categoryFilters button.active { border-color: var(--primary); background-color: #eff6ff; color: var(--primary-dark); font-weight: 600; }
  .checkbox-label { padding: 8px 14px; border: 2px solid var(--gray-300); border-radius: 10px; background-color: white; cursor: pointer; font-size: 0.9rem; transition: all 0.2s; }
  .checkbox-label.active { border-color: var(--success); background-color: #f0fdf4; }

  @media (max-width: 1024px){
    body { padding: 0; } .container { height: 100vh; border-radius: 0; } header { padding: 16px; } header h1 { font-size: 1.2rem; }
    .controls { padding: 12px; } .map-container { padding: 12px; } .main { flex-direction: column; }
    .sidebar { position: fixed; bottom: 0; left: 0; right: 0; width: 100%; height: 90vh; max-height: 90vh; border-left: none; border-top: 1px solid var(--gray-200); border-top-left-radius: 20px; border-top-right-radius: 20px; transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); z-index: 1000; }
    .sidebar:not(.hidden) { transform: translateY(calc(100% - 45vh)); }
    .shop-pin .tooltip { display: none; }
  }
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>ë¶€ì—¬ì¤‘ì•™ì‹œì¥ ë””ì§€í„¸ ë§µ</h1> <p>ì‹¤ì‹œê°„ ìƒì  ì •ë³´ì™€ ìœ„ì¹˜ë¥¼ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”</p>
  </header>
  <div class="controls">
    <div class="controls-row">
      <input id="searchInput" type="search" placeholder="ê°€ê²Œëª…, í’ˆëª© ê²€ìƒ‰...">
      <div id="categoryFilters">
        <button data-category="all" class="active">ì „ì²´</button>
        <button data-category="ìˆ˜/ì¶•ì‚°ë¬¼">ìˆ˜/ì¶•ì‚°ë¬¼</button>
        <button data-category="ê³¼ì±„ë¥˜">ê³¼ì±„ë¥˜</button>
        <button data-category="ê°€ê³µ/ì¦‰ì„ì‹í’ˆ">ê°€ê³µ/ì¦‰ì„ì‹í’ˆ</button>
        <button data-category="ìŒì‹ì ">ìŒì‹ì </button>
        <button data-category="ì˜ë¥˜/ì¡í™”">ì˜ë¥˜/ì¡í™”</button>
        <button data-category="ê¸°íƒ€">ê¸°íƒ€</button>
      </div>
      <label class="checkbox-label">
        <input id="goodtraeCheck" type="checkbox">
        <span>êµ¿ëœ¨ë ˆí˜ì´</span>
      </label>
    </div>
  </div>
  <div class="main" id="mainContainer">
    <div class="map-container">
      <div class="time-control">
        <label>ì‹œê°„</label>
        <div class="time-slider-wrapper">
          <div class="time-marks">
            <span>0</span><span>3</span><span>6</span><span>9</span><span>12</span><span>15</span><span>18</span><span>21</span>
          </div>
          <input type="range" class="time-slider" id="timeSlider" min="0" max="23" value="12" step="1">
        </div>
        <div class="time-display" id="timeDisplay">12:00</div>
      </div>
      <div class="congestion-legend">
        <div class="legend-item"><div class="legend-color" style="background-color:var(--success)"></div><span>ì—¬ìœ </span></div>
        <div class="legend-item"><div class="legend-color" style="background-color:#f59e0b"></div><span>ë³´í†µ</span></div>
        <div class="legend-item"><div class="legend-color" style="background-color:var(--danger)"></div><span>í˜¼ì¡</span></div>
      </div>
      <div class="map-wrapper" id="mapWrapper">
        <div class="market-map" id="marketMap">
          <div class="shop-area area-top"></div> <div class="shop-area area-bottom"></div> <div class="main-road"></div>
          <div class="parking-lot" style="left: 1400px; top: 375px; width: 350px; height: 150px;">ì£¼ì°¨ì¥</div>
          <div class="alley" style="left: 450px;"></div> <div class="alley" style="left: 925px;"></div>
          <div class="alley" style="left: 1350px;"></div> <div class="alley" style="left: 1800px;"></div>
          <div class="congestion-overlay" id="congestionOverlay"></div>
        </div>
      </div>
    </div>
    
    <aside class="sidebar" id="sidebar">
      <button class="close-btn" id="closeBtn">âœ•</button>
      <div class="sidebar-content-wrapper">
        <nav class="sidebar-tabs">
          <button class="tab-button" data-tab="info">ê°€ê²Œ ì •ë³´</button>
          <button class="tab-button active" data-tab="welcome">ì‹œì¥ ì•ˆë‚´</button>
        </nav>
        <div id="infoPanel" class="tab-panel">
          <div class="shop-detail hide" id="shopDetail">
            <h2 id="detailName">ê°€ê²Œ ì´ë¦„</h2> <div class="tags" id="detailTags"></div>
            <div class="info-row" id="detailHours"></div> <div class="info-row" id="detailPhone"></div>
            <p class="description" id="detailDesc"></p>
          </div>
          <div class="shop-list" id="shopListContainer">
            <h3 id="listTitle">ê°€ê²Œ ëª©ë¡</h3> <div id="shopList"></div>
          </div>
        </div>
        <div id="welcomePanel" class="tab-panel active">
          <div class="welcome-panel">
            <h2>ğŸ‰ ë¶€ì—¬ì¤‘ì•™ì‹œì¥ì—<br>ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</h2>
            <p>ë¶€ì—¬ì˜ ë§›ê³¼ ì •ì´ ì‚´ì•„ìˆëŠ” ì „í†µì‹œì¥ì…ë‹ˆë‹¤. ì‹ ì„ í•œ ë†ìˆ˜ì‚°ë¬¼ë¶€í„° ë‹¤ì–‘í•œ ë¨¹ê±°ë¦¬, ìƒí™œìš©í’ˆê¹Œì§€ ëª¨ë“  ê²ƒì´ í•œìë¦¬ì—!</p>
            <div class="welcome-info">
              <div class="info-item">ğŸ“<span>ì¶©ë‚¨ ë¶€ì—¬êµ° ë¶€ì—¬ì ì¤‘ì•™ë¡œ 179-2</span></div>
              <div class="info-item">ğŸ“<span>041-835-3950</span></div>
            </div>
          </div>
        </div>
      </div>
    </aside>
  </div>
</div>

<script>
// ===============================================================
// ğŸ’¡ ê°€ê²Œ ë°ì´í„° ìˆ˜ì • ê°€ì´ë“œ
// ì´ ë°°ì—´ì— ê°€ê²Œ ì •ë³´ë¥¼ ì¶”ê°€, ìˆ˜ì •, ì‚­ì œí•˜ì„¸ìš”.
// ===============================================================
const SHOPS = [
  // ìœ—ì¤„ (y: 125, 215) - ì™¼ìª½ë¶€í„° ì˜¤ë¥¸ìª½ìœ¼ë¡œ ë°°ì¹˜
  { id:"t34", name:"ì €íŒ”ê³„", category:"ìŒì‹ì ", icon:"ğŸ¥“", phone:"041-833-5885", desc:"ë¼ì§€ê³ ê¸°êµ¬ì´, ì‚¼ê²¹ì‚´", x:240, y:70, open:null, close:null, goodtrae: true },
  { id:"t33", name:"í•œêµ­ì†Œ", category:"ì˜ë¥˜/ì¡í™”", icon:"ğŸ¥¼", phone:"041-833-7500", desc:"ë§ì¶¤í•œë³µ ì œì‘", x:520, y:70, open:13, close:19, goodtrae: false },
  { id:"t32", name:"íˆ¬ë°ì´ ì¶©ë‚¨", category:"ê¸°íƒ€", icon:"ğŸ“°", phone:"041-832-5884", desc:"íˆ¬ë°ì´ ì¶©ë‚¨ì„ ë°œê°„í•©ë‹ˆë‹¤", x:50, y:170, open: null, close: null, goodtrae: false },
  { id:"t31", name:"ê¸°ë®¤ê³µë°©", category:"ì˜ë¥˜/ì¡í™”", icon:"ğŸŒ³", phone:"010-1234-5678", desc:"ìˆ˜ê³µì˜ˆì œí’ˆ íŒë§¤", x:120, y:170, open:15, close:20, goodtrae: false },
  { id:"t30", name:"ê¹€í˜„ê²½ í—¤ì–´ìƒµ", category:"ê¸°íƒ€", icon:"ğŸ’‡â€â™€ï¸", phone:"041-832-7557", desc:"ê³ ì–‘ì´ ìƒì£¼ì¤‘", x:240, y:125, open:10, close:18, goodtrae: false },
  { id:"t29", name:"ë ¹ì²œì•”", category:"ê¸°íƒ€", icon:"ğŸ””", phone:"010-6435-0863", desc:"ì , ì‚¬ì£¼, íƒ€ë¡œ ê°€ëŠ¥", x:310, y:125, open:15, close:20, goodtrae: false },
  { id:"t28", name:"ìª¼ë¬¼ìª¼ë¬¼ì—„ë§ˆì†ë§›ì°¬ì§‘", category:"ê°€ê³µ/ì¦‰ì„ì‹í’ˆ", icon:"ğŸ±", phone:"041-836-2461", desc:"ì—„ë§ˆì†ë§›ìœ¼ë¡œ ë§Œë“  ë°˜ì°¬", x:380, y:125, open:13, close:20, goodtrae: true },
  { id:"t27", name:"ì¶©ë‚¨ìƒíšŒ", category:"ê°€ê³µ/ì¦‰ì„ì‹í’ˆ", icon:"ğŸ¦", phone:"041-835-2086", desc:"ì “ê°ˆë¥˜ ì·¨ê¸‰", x:450, y:125, open:10, close:18, goodtrae: false },
  { id:"t26", name:"ì¥í„°í•œìš°êµ­ë°¥", category:"ìŒì‹ì ", icon:"ğŸ²", phone:"041-834-4377", desc:"í•œìš°ë¥¼ ì“´ ì „í†µêµ­ë°¥", x:520, y:125, open:9, close:19, goodtrae: true },
  { id:"t25", name:"ì œì¼ìƒíšŒ", category:"ì˜ë¥˜/ì¡í™”", icon:"ğŸ–¼ï¸", phone:"041-834-4115", desc:"ì—†ëŠ” ê²ƒ ë¹¼ê³  ë‹¤ ìˆìŒ", x:640, y:125, open:9, close:18, goodtrae: false },
  { id:"t24", name:"ì´í™” ì–‘ì¥ìˆ˜ì„ ", category:"ì˜ë¥˜/ì¡í™”", icon:"ğŸ¥¼", phone:"041-832-9491", desc:"í•˜ë£¨ë©´ ì˜·ìˆ˜ì„ ", x:710, y:125, open:10, close:18, goodtrae: true },
  { id:"t23", name:"ì„œìš¸ë‹­ì§‘", category:"ìˆ˜/ì¶•ì‚°ë¬¼", icon:"ğŸ”", phone:"010-1234-5678", desc:"ì‹œê³¨ í†µë‹­êµ¬ì´", x:780, y:125, open:9, close:19, goodtrae: true },
  { id:"t22", name:"ê³ í–¥ì´Œ", category:"ìŒì‹ì ", icon:"ğŸ²", phone:"010-1234-5678", desc:"ì‚¼ê²¹ì‚´, ë³´ë¦¬ë°¥, ê¹€ì¹˜ì°Œê°œ", x:850, y:125, open:13, close:20, goodtrae: true },
  { id:"t21", name:"ì •ê°€ì—° ë¯¸ìš©ì‹¤", category:"ê¸°íƒ€", icon:"ğŸ’‡â€â™€ï¸", phone:"010-1234-5678", desc:"ìµœì‹ í—¤ì–´ìŠ¤íƒ€ì¼ë§", x:990, y:125, open:10, close:19, goodtrae: false },
  { id:"t20", name:"ìš©ì „ë–¡ì§‘", category:"ê°€ê³µ/ì¦‰ì„ì‹í’ˆ", icon:"ğŸ¡", phone:"041-833-8530", desc:"ë”°ëˆí•œ ë–¡ íŒë§¤", x:1060, y:125, open:10, close:18, goodtrae: true },
  { id:"t19", name:"ìê°ˆì¹˜íšŒì„¼íƒ€", category:"ìˆ˜/ì¶•ì‚°ë¬¼", icon:"ğŸŸ", phone:"041-833-5959", desc:"ëª¨ë‘ íšŒ, ì—°ì–´íšŒ ì „ë¬¸", x:1130, y:125, open:11, close:20, goodtrae: true },
  { id:"t18", name:"ì˜¤ë¯¸ë–¡ì§‘", category:"ê°€ê³µ/ì¦‰ì„ì‹í’ˆ", icon:"ğŸ¡", phone:"041-833-6268", desc:"ì „í†µìˆëŠ” ê°€ë˜ë–¡ì§‘", x:1200, y:125, open:10, close:18, goodtrae: false },
  { id:"t17", name:"ë•ì„±ìƒíšŒ", category:"ê°€ê³µ/ì¦‰ì„ì‹í’ˆ", icon:"ğŸ«š", phone:"041-832-8485", desc:"ìƒê°, ë”ë• ì·¨ê¸‰", x:1270, y:125, open:10, close:20, goodtrae: false },
  { id:"t16", name:"ë¶€ì‚°ìƒíšŒ", category:"ê°€ê³µ/ì¦‰ì„ì‹í’ˆ", icon:"ğŸ¦‘", phone:"041-835-4585", desc:"ê±´ì˜¤ì§•ì–´ ì „ë¬¸", x:1420, y:125, open:9, close:19, goodtrae: false },
  { id:"t15", name:"ë™ì–‘ì‹í’ˆ", category:"ê°€ê³µ/ì¦‰ì„ì‹í’ˆ", icon:"ğŸŒ¶ï¸", phone:"041-835-4367", desc:"ì²­ì–‘ê³ ì¶”ë³´ë‹¤ ë§¤ì›€", x:1490, y:125, open:10, close:19, goodtrae: false },
  { id:"t14", name:"ì‹œì¥ìˆœëŒ€", category:"ìŒì‹ì ", icon:"ğŸ²", phone:"041-833-8051", desc:"ë”°ëˆí•œ ìˆœëŒ€êµ­ë°¥", x:1560, y:125, open:10, close:19, goodtrae: true },
  { id:"t13", name:"ë¶€ë¶€ë°˜ì°¬", category:"ê°€ê³µ/ì¦‰ì„ì‹í’ˆ", icon:"ğŸ¥¬", phone:"041-832-0727", desc:"ì¢…ê°€ì§‘ ë°°ì¶”ê¹€ì¹˜", x:1630, y:125, open:9, close:18, goodtrae: true },
  { id:"t12", name:"ê·œì•”ë–¡ì§‘", category:"ê°€ê³µ/ì¦‰ì„ì‹í’ˆ", icon:"ğŸ¡", phone:"041-835-3950", desc:"ê°“ë½‘ì€ ë–¡ ìˆì–´ìš”", x:1700, y:125, open:9, close:17, goodtrae: true },
  { id:"t11", name:"ëˆìš°ì •ìœ¡ì ", category:"ìˆ˜/ì¶•ì‚°ë¬¼", icon:"ğŸ¥“", phone:"041-837-8009", desc:"ìˆ˜ìš”ì¼ì€ ì†Œì¡ëŠ”ë‚ ", x:1770, y:125, open:10, close:20, goodtrae: false },
  { id:"t10", name:"ì‹œì¥ì¤‘ì•™ë‹­ì§‘", category:"ìˆ˜/ì¶•ì‚°ë¬¼", icon:"ğŸ”", phone:"010-1234-5678", desc:"ê¼¬ë¼ì˜¤", x:1840, y:125, open:10, close:18, goodtrae: true },
  { id:"t9", name:"ì˜ì²œìƒíšŒ", category:"ìˆ˜/ì¶•ì‚°ë¬¼", icon:"ğŸŸ", phone:"041-835-3951", desc:"ì¡°ê°œ, ì „ë³µ, í™ì–´ ë“±", x:1910, y:125, open:9, close:18, goodtrae: true },
  { id:"t8", name:"ë³´ë ¹ìˆ˜ì‚°", category:"ìˆ˜/ì¶•ì‚°ë¬¼", icon:"ğŸ ", phone:"010-7741-3281", desc:"ì‹ ì„ í•œ ë¬¼ê³ ê¸° ì·¨ê¸‰", x:1980, y:125, open:10, close:19, goodtrae: true },
  { id:"t7", name:"ê³ ê¸°ë°±í™”ì ", category:"ìˆ˜/ì¶•ì‚°ë¬¼", icon:"ğŸ¥“", phone:"041-933-7878", desc:"ì‹ ì„ í•œ ê³ ê¸° ì·¨ê¸‰", x:2050, y:125, open:10, close:20, goodtrae: false },
  { id:"t6", name:"ìš°ë¦¬ë°˜ì°¬", category:"ê°€ê³µ/ì¦‰ì„ì‹í’ˆ", icon:"ğŸ¥¬", phone:"041-832-9151", desc:"ë°°ì¶”ê¹€ì¹˜ ì „ë¬¸", x:2120, y:125, open:10, close:19, goodtrae: true },
  { id:"t5", name:"ê°•ë‚¨ë–¡ì§‘", category:"ê°€ê³µ/ì¦‰ì„ì‹í’ˆ", icon:"ğŸ¡", phone:"041-834-4545", desc:"ë§›ìˆëŠ” ë–¡ ë§Œë“œëŠ” ì¤‘", x:2190, y:125, open:8, close:18, goodtrae: true },
  { id:"t4", name:"ì—°ìƒíšŒ", category:"ê³¼ì±„ë¥˜", icon:"ğŸ¥¦", phone:"041-836-6698", desc:"ì‹ ì„ í•œ ì±„ì†Œë“¤ ì·¨ê¸‰", x:2260, y:125, open:9, close:19, goodtrae: true },
  { id:"t1a", name:"í™”ë‘íšŒìˆ˜ì‚°", category:"ìˆ˜/ì¶•ì‚°ë¬¼", icon:"ğŸŸ", phone:"010-8606-6472", desc:"ì¡°ê°œ, ì „ë³µ, í™ì–´ ë“±", x:2330, y:125, open:9, close:18, goodtrae: true },

  // ì•„ë«ì¤„ (y: 475) - ì™¼ìª½ë¶€í„° ì˜¤ë¥¸ìª½ìœ¼ë¡œ ë°°ì¹˜
 { id:"c4",  name:"ì¢…ë¡œì— ìŠ¤ì¿¨",        category:"ê¸°íƒ€",       icon:"ğŸ«", phone:"",             desc:"í•™ì›",                    x:50,   y:475, open:12, close:22, goodtrae:false}, 
{ id:"c3",  name:"ì¤‘ì•™í¬ëª©",          category:"ì˜ë¥˜/ì¡í™”",  icon:"ğŸ§µ", phone:"",             desc:"ì›ë‹¨ ë° ë¶€ìì¬",         x:120,  y:475, open:9,  close:18, goodtrae:false},
{ id:"c2",  name:"ë¶€ì—¬ì¹¼êµ­ìˆ˜",        category:"ìŒì‹ì ",     icon:"ğŸœ", phone:"",             desc:"ì†ì¹¼êµ­ìˆ˜ ì „ë¬¸",           x:190,  y:475, open:11, close:20, goodtrae:true},

{ id:"b1",  name:"ì†¡ì´ìƒíšŒ",          category:"ê³¼ì±„ë¥˜",     icon:"ğŸ", phone:"041-836-3625", desc:"ê³¼ì¼Â·ì±„ì†Œ",               x:2330, y:475, open:7,  close:21, goodtrae:false},
{ id:"b2",  name:"ê¸°ìˆ ì ë–¡ì§‘",       category:"ê°€ê³µ/ì¦‰ì„ì‹í’ˆ", icon:"ğŸ¡", phone:"041-832-9364", desc:"ëª¨ì‹œì†¡í¸, ë§ì¶¤ë–¡",    x:2260, y:475, open:8,  close:18, goodtrae:false},
{ id:"b3",  name:"235 ì‹í’ˆ",          category:"ê°€ê³µ/ì¦‰ì„ì‹í’ˆ", icon:"ğŸ›’", phone:"041-835-3414", desc:"ì•¼ì±„ ë„ì†Œë§¤",       x:2190, y:475, open:8,  close:19, goodtrae:false},
{ id:"b4",  name:"ì œì¼ì •ìœ¡ 2í˜¸ì ",    category:"ìˆ˜/ì¶•ì‚°ë¬¼",  icon:"ğŸ¥©", phone:"041-836-3748", desc:"ìƒê³ ê¸°Â·í•œìš°ì•”ì†ŒÂ·ì•”ë¼ì§€", x:2120, y:475, open:8,  close:20, goodtrae:false},
{ id:"b5",  name:"ë¶€ê³¡ ìŒ€ìƒíšŒ",       category:"ê¸°íƒ€",       icon:"ğŸŒ¾", phone:"041-835-2114", desc:"ìŒ€Â·ì¡ê³¡",                x:2050, y:475, open:8,  close:18, goodtrae:false},
{ id:"b6",  name:"ì€ë¯¸ë„¤ ë°˜ì°¬",       category:"ê°€ê³µ/ì¦‰ì„ì‹í’ˆ", icon:"ğŸ¥—", phone:"041-835-0229", desc:"ê°ì¢… ê¹€ì¹˜, ì “ê°ˆë¥˜", x:1980, y:475, open:8,  close:19, goodtrae:false},
{ id:"b7",  name:"í•œì–‘ ìˆ˜ì‚°",         category:"ìˆ˜/ì¶•ì‚°ë¬¼",  icon:"ğŸŸ", phone:"041-835-4095", desc:"ê°ì¢… í•´ë¬¼Â·ìˆ˜ì‚°ë¬¼",      x:1910, y:475, open:7,  close:18, goodtrae:false},
{ id:"b8",  name:"ë™ì¤€ ìƒíšŒ",         category:"ê³¼ì±„ë¥˜",     icon:"ğŸ¥•", phone:"041-835-5413", desc:"ê°ì¢… ì•¼ì±„",             x:1840, y:475, open:8,  close:19, goodtrae:false},
{ id:"b9",  name:"ëŒ€ë™ ìƒíšŒ",         category:"ê¸°íƒ€",       icon:"ğŸŒ¾", phone:"041-835-2114", desc:"ìŒ€Â·ì¡ê³¡",                x:1770, y:475, open:8,  close:18, goodtrae:false},
{ id:"b10", name:"ì›ëª¨í• ì¸ ë§ˆíŠ¸",     category:"ê°€ê³µ/ì¦‰ì„ì‹í’ˆ", icon:"ğŸ§‚", phone:"041-835-3822", desc:"ê±´ì–´ë¬¼Â·ê²¬ê³¼Â·ì‹ìì¬", x:1700, y:475, open:8,  close:20, goodtrae:true},
{ id:"b11", name:"ì‹œì¥ë§›ì§‘",          category:"ìŒì‹ì ",     icon:"ğŸœ", phone:"041-834-9998", desc:"ì˜¬ê°±ì´í•´ì¥êµ­Â·ì¹¼êµ­ìˆ˜Â·ë–¡êµ­", x:1630, y:475, open:10, close:20, goodtrae:true},
{ id:"b12", name:"ì¤‘ì•™ ì†ì˜·",         category:"ì˜ë¥˜/ì¡í™”",  icon:"ğŸ©²", phone:"041-836-3328", desc:"ì†ì˜·Â·ë‚´ë³µ",              x:1560,  y:475, open:9,  close:19, goodtrae:false},
{ id:"b14", name:"ê°•ì› ê³ ì¶”",         category:"ê°€ê³µ/ì¦‰ì„ì‹í’ˆ", icon:"ğŸŒ¶ï¸", phone:"?",          desc:"ê³ ì¶”Â·ì–‘ë…",             x:1490,  y:475, open:8,  close:18, goodtrae:false},
{ id:"b15", name:"í• ì¸ì •ìœ¡ì ê³¼ ì±„ì†Œ", category:"ìˆ˜/ì¶•ì‚°ë¬¼",  icon:"ğŸ¥“", phone:"010-7791-4920", desc:"ì •ìœ¡Â·ì•¼ì±„",            x:1420,  y:475, open:8,  close:20, goodtrae:false},
{ id:"b16", name:"í† ì†ê°€ë§ˆì†¥ í†µë‹­&ë¶„ì‹", category:"ìŒì‹ì ",  icon:"ğŸ—", phone:"041-835-9945", desc:"í†µë‹­Â·ìˆœëŒ€Â·ì¡±ë°œÂ·ëˆ„ë¥¸ê³ ê¸°", x:1350,  y:475, open:10, close:21, goodtrae:true},
{ id:"b17", name:"ë§›ê¹”ì† ë°˜ì°¬ë¶„ì‹",   category:"ìŒì‹ì ",     icon:"ğŸ±", phone:"?",             desc:"ë°˜ì°¬Â·ë¶„ì‹",             x:1280,  y:475, open:10, close:20, goodtrae:false},
{ id:"b19", name:"ì•„ë¦„ ìƒíšŒ",         category:"ê³¼ì±„ë¥˜",     icon:"ğŸ¥’", phone:"010-3417-5326", desc:"ì•¼ì±„Â·ë‚˜ë¬¼",           x:1210,  y:475, open:8,  close:19, goodtrae:false},
{ id:"b20", name:"ìì—°ê³ ì¶” ìƒíšŒ",     category:"ê°€ê³µ/ì¦‰ì„ì‹í’ˆ", icon:"ğŸ«š", phone:"041-835-8836", desc:"ê³ ì¶”Â·ë§ˆëŠ˜Â·ê¸°ë¦„",    x:1140,  y:475, open:8,  close:18, goodtrae:false},

// ì§€ë„ì— ì—†ëŠ” í•­ëª©ì€ ë¦¬ìŠ¤íŠ¸ ìˆœì„œëŒ€ë¡œ ë¼ì›€(ì™•ê³°íƒ• ì•)
{ id:"b22a", name:"ë¶€ëšœë§‰ ì‹ë‹¹",      category:"ìŒì‹ì ",     icon:"ğŸœ", phone:"?",             desc:"ì¹¼êµ­ìˆ˜",                x:1070,  y:475, open:10, close:20, goodtrae:false},
{ id:"b22b", name:"Fat burger slim",  category:"ìŒì‹ì ",     icon:"ğŸ”", phone:"?",             desc:"ìˆ˜ì œ í–„ë²„ê±°",           x:1000,  y:475, open:11, close:21, goodtrae:false},

{ id:"b23", name:"ì™•ê³°íƒ•",            category:"ìŒì‹ì ",     icon:"ğŸ²", phone:"041-835-3243",  desc:"ê³°íƒ•Â·ì–‘ê³°íƒ•Â·ë„ê°€ë‹ˆíƒ•Â·ìˆ˜ìœ¡", x:900,  y:475, open:9,  close:21, goodtrae:true},

// ë§¨ ì˜¤ë¥¸ìª½(ìˆ ì§‘/ë§ˆíŠ¸ ë¸”ë¡)
{ id:"b24a", name:"wednesday",        category:"ì˜ë¥˜/ì¡í™”",  icon:"ğŸº", phone:"041-837-0795",  desc:"ê°ì„± ë°”",               x:800, y:475, open:14, close:23, goodtrae:true},
{ id:"b24b", name:"SADAM",            category:"ìŒì‹ì ",     icon:"ğŸ¶", phone:"041-837-0795",  desc:"ì£¼ë¥˜ íŒë§¤",             x:730, y:475, open:12, close:22, goodtrae:true},
{ id:"b24c", name:"ëŒ€í™” í• ì¸ë§ˆíŠ¸",    category:"ê°€ê³µ/ì¦‰ì„ì‹í’ˆ", icon:"ğŸ›’", phone:"041-837-0795", desc:"ìƒí™œìš©í’ˆ",            x:600, y:475, open:8,  close:21, goodtrae:true},

// ì‚¬ì§„ìƒ ì—¬ê¸° ìœ„ì¹˜
{ id:"c1",  name:"êµ¬ë¦„ í•œì¡°ê°",       category:"ìŒì‹ì ",     icon:"ğŸ°", phone:"",             desc:"ë””ì €íŠ¸ ì¹´í˜",           x:260,  y:475, open:12, close:19, goodtrae:false},

];

// ===============================================================
// ğŸ’¡ í˜¼ì¡ë„ ë°ì´í„° ìˆ˜ì • ê°€ì´ë“œ
// A,B,C,D êµ¬ì—­ì— ë§ì¶° zones ìˆ˜ì •, byHourì—ì„œ ì‹œê°„ëŒ€ë³„ í˜¼ì¡ë„ [0,1,2] ìˆ˜ì •
// ===============================================================
const CONGESTION_DATA = {
  zones: [
    { x: 1900, y: 125, radius: 800 }, // A êµ¬ì—­: ìœ—ì¤„ ì˜¤ë¥¸ìª½
    { x: 1900, y: 475, radius: 800 }, // B êµ¬ì—­: ì•„ë«ì¤„ ì˜¤ë¥¸ìª½
    { x: 500, y: 125, radius: 800 },  // C êµ¬ì—­: ìœ—ì¤„ ì™¼ìª½
    { x: 500, y: 475, radius: 800 },  // D êµ¬ì—­: ì•„ë«ì¤„ ì™¼ìª½
  ],
  byHour: {
    0:[0,0,0,0], 1:[0,0,0,0], 2:[0,0,0,0], 3:[0,0,0,0], 4:[0,0,0,0], 5:[0,0,0,0],
    6:[0,0,0,0], 7:[0,0,0,0], 8:[1,0,0,0], 9:[1,1,1,0],
    10:[2,1,0,0], 11:[2,1,0,1], 12:[2,1,1,1], 13:[1,1,1,0],
    14:[1,1,1,0], 15:[1,1,0,0], 16:[1,0,0,0], 17:[1,0,0,0],
    18:[0,0,0,0], 19:[0,0,0,0], 20:[0,0,0,0], 21:[0,0,0,0], 22:[0,0,0,0], 23:[0,0,0,0]
  }
};
const CONGESTION_COLORS = ['#10b981', '#f59e0b', '#ef4444'];

const els = {
  map: document.getElementById('marketMap'), mapWrapper: document.getElementById('mapWrapper'), list: document.getElementById('shopList'),
  searchInput: document.getElementById('searchInput'), categoryFilters: document.getElementById('categoryFilters'), goodtraeCheck: document.getElementById('goodtraeCheck'),
  sidebar: document.getElementById('sidebar'), closeBtn: document.getElementById('closeBtn'),
  shopDetail: document.getElementById('shopDetail'), detailName: document.getElementById('detailName'), detailTags: document.getElementById('detailTags'),
  detailHours: document.getElementById('detailHours'), detailPhone: document.getElementById('detailPhone'), detailDesc: document.getElementById('detailDesc'),
  timeSlider: document.getElementById('timeSlider'), timeDisplay: document.getElementById('timeDisplay'),
  congestionOverlay: document.getElementById('congestionOverlay'), infoPanel: document.getElementById('infoPanel'),
  welcomePanel: document.getElementById('welcomePanel'), shopListContainer: document.getElementById('shopListContainer'),
  sidebarTabs: document.querySelector('.sidebar-tabs'), listTitle: document.getElementById('listTitle')
};

let currentShop = null, currentHour = 12;
let scale = 1, panX = 0, panY = 0;
let startPos = { x: 0, y: 0 }, lastPan = { x: 0, y: 0 };
let isMapDragging = false;

function updateMapTransform() {
  const minScale = getMinScale(); scale = Math.max(minScale, scale);
  const maxPanX = Math.max(0, (2400 * scale - els.mapWrapper.clientWidth));
  const maxPanY = Math.max(0, (600 * scale - els.mapWrapper.clientHeight));
  panX = Math.max(-maxPanX, Math.min(0, panX)); panY = Math.max(-maxPanY, Math.min(0, panY));
  els.map.style.transform = `translate(${panX}px, ${panY}px) scale(${scale})`;
}

function getMinScale() { return Math.max(els.mapWrapper.clientWidth / 2400, els.mapWrapper.clientHeight / 600); }

function setInitialMapState() {
  scale = getMinScale();
  panX = (els.mapWrapper.clientWidth - 2400 * scale) / 2;
  panY = (els.mapWrapper.clientHeight - 600 * scale) / 2;
  updateMapTransform();
}

const handleDragMove = (e) => {
    const isTouch = e.touches && e.touches.length > 0;
    const currentX = isTouch ? e.touches[0].clientX : e.clientX;
    const currentY = isTouch ? e.touches[0].clientY : e.clientY;

    if (!isMapDragging && Math.hypot(currentX - startPos.x, currentY - startPos.y) > 10) {
        isMapDragging = true;
    }
    
    if (isMapDragging) {
        if(e.cancelable) e.preventDefault();
        panX = lastPan.x + (currentX - startPos.x); panY = lastPan.y + (currentY - startPos.y);
        updateMapTransform();
    }
};
const handleDragEnd = () => {
    window.removeEventListener('mousemove', handleDragMove); window.removeEventListener('mouseup', handleDragEnd);
    window.removeEventListener('touchmove', handleDragMove); window.removeEventListener('touchend', handleDragEnd);
};
els.mapWrapper.addEventListener('mousedown', (e) => {
    isMapDragging = false;
    startPos = { x: e.clientX, y: e.clientY }; lastPan = { x: panX, y: panY };
    window.addEventListener('mousemove', handleDragMove);
    window.addEventListener('mouseup', handleDragEnd);
});
els.mapWrapper.addEventListener('touchstart', (e) => {
    if (e.touches.length === 1) {
        isMapDragging = false;
        startPos = { x: e.touches[0].clientX, y: e.touches[0].clientY }; lastPan = { x: panX, y: panY };
        window.addEventListener('touchmove', handleDragMove, { passive: false });
        window.addEventListener('touchend', handleDragEnd);
    }
}, { passive: false });


els.mapWrapper.addEventListener('wheel', (e) => {
  e.preventDefault();
  const rect = els.mapWrapper.getBoundingClientRect();
  const mouseX = e.clientX - rect.left; const mouseY = e.clientY - rect.top;
  const mouseBeforeZoomX = (mouseX - panX) / scale; const mouseBeforeZoomY = (mouseY - panY) / scale;
  const newScale = scale * (e.deltaY > 0 ? 0.9 : 1.1);
  scale = Math.min(Math.max(getMinScale(), newScale), 3);
  panX = mouseX - mouseBeforeZoomX * scale; panY = mouseY - mouseBeforeZoomY * scale;
  updateMapTransform();
}, { passive: false });

const mapResizeObserver = new ResizeObserver(() => { setInitialMapState(); });
mapResizeObserver.observe(els.mapWrapper);

function openSidebar(tabName = 'welcome') {
  els.sidebar.classList.remove('hidden');
  els.sidebarTabs.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
  const activeTab = els.sidebarTabs.querySelector(`[data-tab="${tabName}"]`);
  if (activeTab) activeTab.classList.add('active');
  
  document.querySelectorAll('.tab-panel').forEach(panel => panel.classList.remove('active'));
  document.getElementById(tabName === 'info' ? 'infoPanel' : 'welcomePanel').classList.add('active');
  
  if (tabName === 'info' && !currentShop) {
      els.shopDetail.classList.add('hide');
      els.shopListContainer.classList.remove('hide');
      els.listTitle.textContent = "ê°€ê²Œ ëª©ë¡";
      renderList();
  }
}

function closeSidebar() {
  els.sidebar.classList.add('hidden');
  currentShop = null;
  document.querySelectorAll('.shop-pin.active, .list-item.active').forEach(el => el.classList.remove('active'));
}

els.closeBtn.addEventListener('click', closeSidebar);
els.sidebarTabs.addEventListener('click', (e) => {
  if (e.target.matches('.tab-button')) {
    const tabName = e.target.dataset.tab;
    currentShop = null;
    document.querySelectorAll('.shop-pin.active').forEach(el => el.classList.remove('active'));
    openSidebar(tabName);
  }
});

function isShopOpen(shop, hour) {
    if (shop.open === null || shop.close === null) return false;
    return !(shop.open !== undefined && (hour < shop.open || hour >= shop.close)); 
}

function updateTime(hour) {
  currentHour = hour;
  els.timeDisplay.textContent = `${String(hour).padStart(2, '0')}:00`;
  updateShopStatus(hour);
  updateSliderBackground(hour);
  updateCongestion(hour);
}

function updateSliderBackground(hour) {
  const percentage = (hour / 23) * 100;
  els.timeSlider.style.background = `linear-gradient(to right, var(--primary) ${percentage}%, var(--gray-200) ${percentage}%)`;
}

function updateShopStatus(hour) {
  document.querySelectorAll('.shop-pin').forEach(pin => {
    const shop = SHOPS.find(s => s.id === pin.dataset.id);
    if (shop) pin.classList.toggle('closed', !isShopOpen(shop, hour));
  });
  if(currentShop) showDetail(currentShop.id, false);
}

function updateCongestion(hour) {
    els.congestionOverlay.innerHTML = '';
    const levels = CONGESTION_DATA.byHour[hour];
    if (!levels) return;

    CONGESTION_DATA.zones.forEach((zone, i) => {
        const level = levels[i];
        if (level === 0) return;
        
        const dot = document.createElement('div');
        dot.className = 'congestion-zone';
        dot.style.cssText = `
            left: ${zone.x}px;
            top: ${zone.y}px;
            width: ${zone.radius}px;
            height: ${zone.radius}px;
            transform: translate(-50%, -50%);
            background-color: ${CONGESTION_COLORS[level]};
        `;
        els.congestionOverlay.appendChild(dot);
    });
}

function createPin(shop) {
  const pin = document.createElement('div');
  pin.className = `shop-pin`;
  pin.style.cssText = `left:${shop.x}px; top:${shop.y}px;`;
  pin.dataset.id = shop.id;
  pin.innerHTML = `
    <button>
      <div class="icon">${shop.icon || 'ğŸª'}</div>
      <div class="name">${shop.name}</div>
      <span class="tooltip">${shop.desc || 'ì •ë³´ ì—†ìŒ'}</span>
    </button>
  `;
  pin.querySelector('button').onclick = (e) => {
    if(!isMapDragging) showDetail(shop.id);
  };
  return pin;
}

function showDetail(id, fromList = true) {
  const shop = SHOPS.find(s => s.id === id); if (!shop) return;
  currentShop = shop;
  if (fromList) { openSidebar('info'); }
  els.shopDetail.classList.remove('hide');
  els.shopListContainer.classList.remove('hide');
  
  els.detailName.textContent = shop.name;
  els.detailTags.innerHTML = `<span class="tag">${shop.category}</span>` + (shop.goodtrae ? `<span class="tag goodtrae">êµ¿ëœ¨ë ˆí˜ì´</span>` : '');
  const openStatus = isShopOpen(shop, currentHour);
  if (shop.open === null) {
      els.detailHours.innerHTML = '<span>ğŸ• ì˜ì—…ì‹œê°„ ì •ë³´ ì—†ìŒ</span>';
  } else {
      els.detailHours.innerHTML = `<span>ğŸ• ${String(shop.open).padStart(2, '0')}:00 - ${String(shop.close).padStart(2, '0')}:00</span><span class="status-indicator ${openStatus ? 'status-open' : 'status-closed'}">${openStatus ? 'ğŸŸ¢' : 'ğŸ”´'}</span>`;
  }
  els.detailPhone.innerHTML = shop.phone ? `ğŸ“ <span>${shop.phone}</span>` : '';
  els.detailDesc.textContent = shop.desc || '';
  
  document.querySelectorAll('.shop-pin.active').forEach(el => el.classList.remove('active'));
  document.querySelector(`.shop-pin[data-id="${id}"]`)?.classList.add('active');
  
  els.listTitle.textContent = "ê°™ì€ ì—…ì¢… ê°€ê²Œ";
  renderList(shop.category, shop.id);
}

function matchesFilter(shop) {
    const query = els.searchInput.value.toLowerCase().trim();
    const activeCategoryBtn = els.categoryFilters.querySelector('button.active');
    const category = activeCategoryBtn ? activeCategoryBtn.dataset.category : 'all';
    const searchText = `${shop.name} ${shop.category} ${shop.desc}`.toLowerCase();
    
    return (!query || searchText.includes(query)) &&
           (category === 'all' || shop.category === category) &&
           (!els.goodtraeCheck.checked || shop.goodtrae);
}

function renderPins() {
    els.map.querySelectorAll('.shop-pin').forEach(p => p.remove());
    SHOPS.forEach(shop => els.map.appendChild(createPin(shop)));
    updatePinVisibility();
}

function updatePinVisibility() {
  document.querySelectorAll('.shop-pin').forEach(pin => {
    const shop = SHOPS.find(s => s.id === pin.dataset.id);
    if(shop) pin.classList.toggle('dimmed', !matchesFilter(shop));
  });
}

function renderList(relatedCategory = null, currentShopId = null) {
  const filtered = SHOPS.filter(shop => {
    if (relatedCategory) {
      return shop.category === relatedCategory && shop.id !== currentShopId;
    }
    return matchesFilter(shop);
  });
  
  if (filtered.length === 0) {
    els.list.innerHTML = `<div style="text-align:center; padding: 20px; color: var(--gray-600);">${relatedCategory ? 'ë‹¤ë¥¸ ê°€ê²Œê°€ ì—†ìŠµë‹ˆë‹¤' : 'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤'}</div>`;
  } else {
    els.list.innerHTML = filtered.map(shop => `<button class="list-item" data-id="${shop.id}"><div>${shop.icon || 'ğŸª'} ${shop.name}</div></button>`).join('');
    els.list.querySelectorAll('.list-item').forEach(item => { item.onclick = () => showDetail(item.dataset.id); });
  }

  document.querySelectorAll('.list-item.active').forEach(el => el.classList.remove('active'));
  if (currentShop) {
      const activeListItem = els.list.querySelector(`.list-item[data-id="${currentShop.id}"]`);
      if(activeListItem) activeListItem.classList.add('active');
  }
}

function handleFilterChange() {
    updatePinVisibility();
    if (els.sidebar.querySelector('[data-tab="info"]').classList.contains('active') && !currentShop) {
        renderList();
    }
}

els.searchInput.addEventListener('input', handleFilterChange);

els.categoryFilters.addEventListener('click', (e) => {
    if(e.target.matches('button')) {
        els.categoryFilters.querySelector('button.active').classList.remove('active');
        e.target.classList.add('active');
        handleFilterChange();
    }
});

els.goodtraeCheck.addEventListener('change', (e) => {
    e.target.closest('.checkbox-label').classList.toggle('active', e.target.checked);
    handleFilterChange();
});

els.timeSlider.addEventListener('input', (e) => updateTime(parseInt(e.target.value)));

const initialHour = new Date().getHours();
els.timeSlider.value = initialHour;
renderPins();
updateTime(initialHour);
openSidebar('welcome');
setTimeout(setInitialMapState, 100);
</script>
</body>
</html>